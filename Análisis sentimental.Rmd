---
title: "Análisis sentimental"
author: "Oscar Naranjo"
date: "17/3/2020"
output: pdf_document
---

#**1.tokenize data**
##*extraigo y unnest la data que voy a usar en el análisis sentimental*
```{r}
sentimiento<-data_df%>%
unnest_tokens(word, caption)
```

#**2.Cargo diccionario-sentimental**
##*2.a.cargo diccionario-sentimental al proyecto (NRC_WORDS_with_sentiment_usar_este)*
##*2.b.cargo diccionario-sentimental al global environment*
```{r}
NRC_es <- read.csv("/cloud/project/NRC WORDS with sentiment_usar_este.csv", row.names=NULL, sep=";", stringsAsFactors=FALSE)
```

#**3.Cotejar NRC_es con sentimiento**
##*inner join de sentimiento con NRC_es para que se relacione el diccionario-sentimental con data de sentimiento*
###*count de sentiment y word*
##*3.a.reviso las palabras y el sentimiento que tienen asociado, para ver si debo hacer algun cambio en el diccionario*
###*en este caso no debi hacer ningún cambio*
```{r}
scores_chart<-sentimiento%>%
  inner_join(NRC_es, by=c("word"="word"))%>%
  filter(!grepl("positivo|negativo", sentiment))%>%
  count(sentiment, word)
```

#**4.Cotejar NRC_es con sentimiento**
###*count de sentiment*
##*esta es la versión final a usar despues de la corrección del paso 3*
```{r}
scores_chart<-sentimiento%>%
  inner_join(NRC_es, by=c("word"="word"))%>%
  filter(!grepl("positivo|negativo", sentiment))%>%
  count(sentiment)
```

#**5.Genero chart radar**
##*este chart radar plotea los sentimientos*
```{r}
chartJSRadar(scores_chart)
```

#**6.genero scores_cloud**
##*esto para generar una nube de palabras por sentimiento*
```{r}
scores_cloud<-sentimiento%>%
  inner_join(NRC_es, by=c("word"="word"))%>%
  filter(!grepl("positivo|negativo", sentiment))%>%
  count(word, sentiment)%>%
  spread(sentiment, n, fill=0)%>%
  data.frame(row.names = "word")
```

##*6.a.Ploteo nube*
```{r}
comparison.cloud(scores_cloud, max.words=60, title.size=1, scale = c(1,1), random.order = FALSE)
```

#**7.Genero frecuencia**
##*creo scores_fq para poder plotear frecuencia*
```{r}
scores_fq<-sentimiento%>%
  inner_join(NRC_es, by=c("word"="word"))%>%
  filter(grepl("positivo|negativo", sentiment))%>%
  count(word, sentiment)%>%
  spread(sentiment, n, fill=0)%>%
  mutate(polarity=positivo-negativo)%>%
  mutate(pos_or_neg=ifelse(polarity>0 , "positivo", "negativo"))
```

##*7.a.Ploteo frecuencia*
```{r}
ggplot(scores_fq, aes(reorder(word, polarity), polarity, fill=pos_or_neg))+
  geom_col()+
  ggtitle("scores_fq")+
  theme(axis.text.x=element_text(angle=90, vjust = -0,1))
```

##*7.b.si deseo plotear la frecuencia de uno de los sentimientos para ver las palabras que más se repiten en cada sentimiento*
###*aplico barplot, seleccionado en height la columna o sentimiento que deseo ver y names lo hago manual, observando scores_cloud, ylab="Frecuencia"para poner nombre a eje y y lo mismo con xlab*
```{r}
barplot(height=sort(scores_cloud$alegria, decreasing = TRUE)[1:5], names=c("mejor","felicidad", "bueno", "alegría", "pasión")[1:5], las=2, ylim=c(0, 400), main = "5 Palabras más repetidas - Alegría", col="yellow")
```
